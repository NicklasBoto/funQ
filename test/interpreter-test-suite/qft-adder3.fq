main : Bit >< Bit >< Bit
main = meas3 (QFTI3 cAdd3)

exIntA : QBit >< QBit >< QBit
exIntA = QFT3 ((new 0, new 1, new 1))
         
exIntB : QBit >< QBit >< QBit
exIntB = (new 0, new 0, new 1)

cAdd3 : (QBit >< QBit >< QBit)
cAdd3 = let (a0, a1, a2) = exIntA in   
        let (b0, b1, b2) = exIntB in    
        let (b21, a01) = CR  (b2, a0)   in
        let (b11, a02) = CR2 (b1, a01)  in
        let (b01, a03) = CR4 (b0, a02)  in
        let (b12, a11) = CR  (b11, a1)  in
        let (b02, a12) = CR2 (b01, a11) in
        let (b03, a21) = CR  (b02, a2)  in
        (a03,a12,a21)

swap3 : (QBit >< QBit >< QBit) -o (QBit >< QBit >< QBit)
swap3 q = let (a,b,c) = q in
           let (a1,c1) = SWAP (a,c) in
           (a1,b,c1)

meas3 : (QBit >< QBit >< QBit) -o (Bit >< Bit >< Bit)
meas3 q = let (a,b,c) = q in (meas a,meas b,meas c)

qft : (QBit >< QBit >< QBit) -o (QBit >< QBit >< QBit)
qft q = let (q0, q1, q2) = q in
        let (q11, q01) = CR2 (q1, H q0) in
        let (q21, q02) = CR4 (q2, q01) in
        let (q22, q12) = CR2 (q21, H q11) in
        let (q03, q23) = SWAP (q02, H q22) in
        (q03, q12, q23)
-- 
qfti : (QBit >< QBit >< QBit) -o (QBit >< QBit >< QBit)
qfti q = let (q0,q1,q2) = q in
         let (q01,q21) = SWAP (q0,q2) in
         let (q22,q11) = CR2D (H q21, q1) in
         let (q23,q02) = CR4D (q22, q01) in
         let (q12,q03) = CR2D (H q11, q02) in
         (H q03,q12,q23)